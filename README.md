# experiment4th

一、安装scala
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片1.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片2.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片3.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片4.png)
问题：
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片5.png)
解决：
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片6.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片7.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片8.png)

二、安装spark
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片9.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片10.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片11.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片12.png)
试运行：
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片13.png)
配置环境变量：
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片14.png)
启动spark-shell:
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片15.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片16.png)
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片17.png)
pyspark安装：
![image](https://github.com/scs0413/experiment4th/blob/main/img/图片18.png)

三、任务一
1、创建spark会话、设置日志级别
![image](https://github.com/scs0413/experiment4th/blob/main/img/111.pic.jpg)
提取年份
![image](https://github.com/scs0413/experiment4th/blob/main/img/112.pic.jpg)
对数据进行排序
![image](https://github.com/scs0413/experiment4th/blob/main/img/113.pic.jpg)
2、计算stock_price_close与stock_pric_open的差价并进行排序
![image](https://github.com/scs0413/experiment4th/blob/main/img/121.pic.jpg)

四、任务二
1、读取数据集并过滤出IBM的数据
![image](https://github.com/scs0413/experiment4th/blob/main/img/211.pic.jpg)
关联两张表
![image](https://github.com/scs0413/experiment4th/blob/main/img/212.pic.jpg)
2、过滤出苹果公司的数据
![image](https://github.com/scs0413/experiment4th/blob/main/img/221.pic.jpg)
提取年
![image](https://github.com/scs0413/experiment4th/blob/main/img/222.pic.jpg)
计算每年的交易天数
![image](https://github.com/scs0413/experiment4th/blob/main/img/223.pic.jpg)
计算每年总的调整后收盘价总和
![image](https://github.com/scs0413/experiment4th/blob/main/img/224.pic.jpg)
关联每年总的调整后收盘价总和和每年的交易天数
![image](https://github.com/scs0413/experiment4th/blob/main/img/225.pic.jpg)
计算年平均调整后收盘价
![image](https://github.com/scs0413/experiment4th/blob/main/img/226.pic.jpg)
过滤出年平均调整后收盘价大于50的年份
![image](https://github.com/scs0413/experiment4th/blob/main/img/227.pic.jpg)

五、任务三
提取月份特征
![image](https://github.com/scs0413/experiment4th/blob/main/img/311.pic.jpg)
对stock_symbol列进行浓度编码，即在该值内，涨的数量/该值内总数量
数据注册为临时表
![image](https://github.com/scs0413/experiment4th/blob/main/img/312.pic.jpg)
stock_symbol编码表
![image](https://github.com/scs0413/experiment4th/blob/main/img/313.pic.jpg)
对数据集中的stock_symbol字段进行转换
![image](https://github.com/scs0413/experiment4th/blob/main/img/314.pic.jpg)
与stock_symbol同样的方式，对exchange进行浓度编码
![image](https://github.com/scs0413/experiment4th/blob/main/img/315.pic.jpg)
exchange编码表
![image](https://github.com/scs0413/experiment4th/blob/main/img/316.pic.jpg)
对数据集中的exchange字段进行转换
![image](https://github.com/scs0413/experiment4th/blob/main/img/317.pic.jpg)
选取特征列表
![image](https://github.com/scs0413/experiment4th/blob/main/img/318.pic.jpg)
特征组合为向量
![image](https://github.com/scs0413/experiment4th/blob/main/img/319.pic.jpg)
删除缺失值的数据
![image](https://github.com/scs0413/experiment4th/blob/main/img/320.pic.jpg)
将数据按照8:2切分为训练集和测试集
![image](https://github.com/scs0413/experiment4th/blob/main/img/321.pic.jpg)
（1）逻辑回归模型
![image](https://github.com/scs0413/experiment4th/blob/main/img/322.pic.jpg)
（2）决策树模型
![image](https://github.com/scs0413/experiment4th/blob/main/img/323.pic.jpg)
根据评价指标可见，逻辑回归模型效果更优，因此采用逻辑回归模型对数据进行预测
![image](https://github.com/scs0413/experiment4th/blob/main/img/324.pic.jpg)
